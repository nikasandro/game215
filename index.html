<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Super Dino Game - Phaser</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
    }
    canvas {
      display: block;
      margin: auto;
    }
  </style>
</head>
<body>
<script>
  const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 400,
    backgroundColor: '#fff',
    physics: {
      default: 'arcade',
      arcade: {
        gravity: { y: 1000 },
        debug: false
      }
    },
    scene: {
      preload,
      create,
      update
    }
  };

  let dino, cursors, scoreText, highScoreText, ground;
  let obstacles, clouds;
  let score = 0;
  let highScore = 0;
  let isGameOver = false;
  let nightMode = false;
  let soundOn = true;
  let jumpSound, gameOverSound;

  const game = new Phaser.Game(config);

  function preload() {
    this.load.image('dino', 'dinosaur.png');
    this.load.image('cactus', 'cactus.png');
    this.load.image('cloud', 'cloud.png');
    this.load.audio('jumpSound', 'https://www.soundjay.com/button/beep-07.wav');
    this.load.audio('gameOverSound', 'https://www.soundjay.com/button/beep-10.wav');
  }

  function create() {
    this.cameras.main.setBackgroundColor('#fff');

    clouds = this.add.group();

    ground = this.add.rectangle(400, 390, 800, 20, 0x555555);
    this.physics.add.existing(ground, true);

    dino = this.physics.add.sprite(100, 300, 'dino').setScale(1).setCollideWorldBounds(true);
    this.physics.add.collider(dino, ground);

    obstacles = this.physics.add.group();
    this.physics.add.collider(obstacles, ground);
    this.physics.add.overlap(dino, obstacles, gameOver, null, this);

    cursors = this.input.keyboard.createCursorKeys();
    this.input.keyboard.on('keydown-P', () => this.scene.pause());
    this.input.on('pointerdown', jump, this);

    scoreText = this.add.text(600, 10, 'Score: 0', { fontSize: '20px', fill: '#000' });
    highScore = localStorage.getItem("phaserDinoHighScore") || 0;
    highScoreText = this.add.text(600, 40, `High Score: ${highScore}`, { fontSize: '20px', fill: '#000' });

    jumpSound = this.sound.add('jumpSound');
    gameOverSound = this.sound.add('gameOverSound');

    this.time.addEvent({ delay: 1000, callback: spawnObstacle, callbackScope: this, loop: true });
    this.time.addEvent({ delay: 3000, callback: spawnCloud, callbackScope: this, loop: true });
    this.time.addEvent({
      delay: 100,
      loop: true,
      callback: () => {
        if (!isGameOver) {
          score++;
          scoreText.setText(`Score: ${score}`);
        }
      }
    });

    this.input.keyboard.on('keydown-N', () => toggleNight(this));
    this.input.keyboard.on('keydown-S', () => toggleSound());
  }

  function update() {
    if ((cursors.space.isDown || cursors.up.isDown) && dino.body.touching.down && !isGameOver) {
      jump();
    }
  }

  function jump() {
    if (dino.body.touching.down) {
      dino.setVelocityY(-400);
      if (soundOn) jumpSound.play();
    }
  }

  function spawnObstacle() {
    if (isGameOver) return;
    const obs = obstacles.create(800, 360, 'cactus');
    obs.setVelocityX(-200);
    obs.setImmovable();
  }

  function spawnCloud() {
    const cloud = clouds.create(800, Phaser.Math.Between(20, 100), 'cloud');
    cloud.setVelocityX(-50);
    cloud.setAlpha(0.5);
    cloud.setDepth(-1);
    setTimeout(() => cloud.destroy(), 20000);
  }

  function gameOver() {
    if (isGameOver) return;
    isGameOver = true;
    dino.setTint(0xff0000);
    if (soundOn) gameOverSound.play();
    this.physics.pause();

    const gameOverText = this.add.text(400, 200, 'Game Over!', { fontSize: '48px', fill: 'red' }).setOrigin(0.5);
    this.add.text(400, 260, 'Click to Restart', { fontSize: '24px', fill: '#000' }).setOrigin(0.5);

    if (score > highScore) {
      localStorage.setItem("phaserDinoHighScore", score);
    }

    this.input.once('pointerdown', () => location.reload());
  }

  function toggleNight(scene) {
    nightMode = !nightMode;
    scene.cameras.main.setBackgroundColor(nightMode ? '#111' : '#fff');
    scoreText.setColor(nightMode ? '#fff' : '#000');
    highScoreText.setColor(nightMode ? '#fff' : '#000');
  }

  function toggleSound() {
    soundOn = !soundOn;
  }
</script>
</body>
</html>
