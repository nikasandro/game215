<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Super Dino Game - Phaser</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.js"></script>
  <style>
    body {
      margin: 0;
    }
    canvas {
      display: block;
      margin: auto;
    }
  </style>
</head>
<body>

<script>
  const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 400,
    backgroundColor: '#ffffff',
    physics: {
      default: 'arcade',
      arcade: {
        gravity: { y: 600 },
        debug: false
      }
    },
    scene: {
      preload,
      create,
      update
    }
  };

  let player, cursors, score = 0, scoreText, highScore = 0, highScoreText;
  let obstacles, clouds, isGameOver = false;
  let jumpSound, gameOverSound;
  let nightMode = false;
  let nightButton, soundButton, soundOn = true;

  const game = new Phaser.Game(config);

  function preload() {
    this.load.image('dino', 'dinosaur.png');
    this.load.image('cactus', 'cactus.png');
    this.load.image('cloud', 'cloud.png');
    this.load.audio('jump', 'https://www.soundjay.com/button/beep-07.wav');
    this.load.audio('gameover', 'https://www.soundjay.com/button/beep-10.wav');
  }

  function create() {
    // Sky
    clouds = this.physics.add.group();

    // Player
    player = this.physics.add.sprite(100, 300, 'dino').setScale(1).setCollideWorldBounds(true);
    
    // Ground
    const ground = this.add.rectangle(400, 390, 800, 20, 0x555555);
    this.physics.add.existing(ground, true);
    this.physics.add.collider(player, ground);

    // Obstacle Group
    obstacles = this.physics.add.group();

    // Score Display
    scoreText = this.add.text(600, 10, 'Score: 0', { fontSize: '20px', fill: '#000' });
    highScore = localStorage.getItem("phaserDinoHigh") || 0;
    highScoreText = this.add.text(600, 40, `High Score: ${highScore}`, { fontSize: '20px', fill: '#000' });

    // Input
    cursors = this.input.keyboard.createCursorKeys();
    this.input.on('pointerdown', jump, this);

    // Timers
    this.time.addEvent({ delay: 2000, callback: spawnObstacle, callbackScope: this, loop: true });
    this.time.addEvent({ delay: 3000, callback: spawnCloud, callbackScope: this, loop: true });
    this.time.addEvent({
      delay: 100,
      callback: () => {
        if (!isGameOver) {
          score++;
          scoreText.setText(`Score: ${score}`);
          if (score % 100 === 0) {
            obstacles.children.iterate(obs => obs.body.velocity.x -= 20);
          }
        }
      },
      loop: true
    });

    // Audio
    jumpSound = this.sound.add('jump');
    gameOverSound = this.sound.add('gameover');

    // Night Mode Toggle
    nightButton = this.add.text(20, 10, '🌙', { fontSize: '24px', fill: '#000' })
      .setInteractive()
      .on('pointerdown', () => {
        nightMode = !nightMode;
        this.cameras.main.setBackgroundColor(nightMode ? '#222222' : '#ffffff');
        [scoreText, highScoreText, nightButton, soundButton].forEach(el =>
          el.setColor(nightMode ? '#ffffff' : '#000000')
        );
        nightButton.setText(nightMode ? '☀️' : '🌙');
      });

    // Sound Toggle
    soundButton = this.add.text(70, 10, '🔊', { fontSize: '24px', fill: '#000' })
      .setInteractive()
      .on('pointerdown', () => {
        soundOn = !soundOn;
        soundButton.setText(soundOn ? '🔊' : '🔇');
      });

    // Collision
    this.physics.add.overlap(player, obstacles, hitObstacle, null, this);
  }

  function update() {
    if (cursors.space.isDown || cursors.up.isDown) {
      jump();
    }
  }

  function jump() {
    if (!isGameOver && player.body.touching.down) {
      player.setVelocityY(-300);
      if (soundOn) jumpSound.play();
    }
  }

  function spawnObstacle() {
    if (isGameOver) return;
    const obs = obstacles.create(800, 360, 'cactus');
    obs.setVelocityX(-200);
    obs.setImmovable();
    obs.setCollideWorldBounds(false);
  }

  function spawnCloud() {
    const cloud = clouds.create(800, Phaser.Math.Between(20, 100), 'cloud');
    cloud.setVelocityX(-50);
    cloud.setAlpha(0.5);
    cloud.setDepth(-1);
    this.time.delayedCall(20000, () => cloud.destroy());
  }

  function hitObstacle() {
    if (isGameOver) return;
    isGameOver = true;
    player.setTint(0xff0000);
    if (soundOn) gameOverSound.play();
    this.physics.pause();
    this.add.text(400, 200, 'Game Over!', {
      fontSize: '48px',
      fill: 'red'
    }).setOrigin(0.5);

    if (score > highScore) {
      localStorage.setItem("phaserDinoHigh", score);
    }

    this.add.text(400, 250, 'Click to Restart', {
      fontSize: '24px',
      fill: '#000'
    }).setOrigin(0.5);

    this.input.once('pointerdown', () => location.reload());
  }
</script>

</body>
</html>
